<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>2 Generate Pseudo Data | Data preparation for Harvard Talk</title>
  <meta name="description" content="2 Generate Pseudo Data | Data preparation for Harvard Talk" />
  <meta name="generator" content="bookdown 0.22.2 and GitBook 2.6.7" />

  <meta property="og:title" content="2 Generate Pseudo Data | Data preparation for Harvard Talk" />
  <meta property="og:type" content="book" />
  
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="2 Generate Pseudo Data | Data preparation for Harvard Talk" />
  
  
  

<meta name="author" content="Tim Disher" />


<meta name="date" content="2021-05-18" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="index.html"/>
<link rel="next" href="all-analyses.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<script src="libs/accessible-code-block-0.0.1/empty-anchor.js"></script>
<link href="libs/anchor-sections-1.0.1/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0.1/anchor-sections.js"></script>


<style type="text/css">
code.sourceCode > span { display: inline-block; line-height: 1.25; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Project Information</a></li>
<li class="chapter" data-level="2" data-path="generate-pseudo-data.html"><a href="generate-pseudo-data.html"><i class="fa fa-check"></i><b>2</b> Generate Pseudo Data</a><ul>
<li class="chapter" data-level="2.1" data-path="generate-pseudo-data.html"><a href="generate-pseudo-data.html#generate-data-from-synthpop"><i class="fa fa-check"></i><b>2.1</b> Generate data from synthpop</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="all-analyses.html"><a href="all-analyses.html"><i class="fa fa-check"></i><b>3</b> All analyses</a><ul>
<li class="chapter" data-level="3.1" data-path="all-analyses.html"><a href="all-analyses.html#things-we-can-do-without-access-to-ipd"><i class="fa fa-check"></i><b>3.1</b> Things we can do without access to IPD</a><ul>
<li class="chapter" data-level="3.1.1" data-path="all-analyses.html"><a href="all-analyses.html#adjusting-p-value-for-decision-at-hand"><i class="fa fa-check"></i><b>3.1.1</b> Adjusting p-value for decision at hand</a></li>
<li class="chapter" data-level="3.1.2" data-path="all-analyses.html"><a href="all-analyses.html#mcda-from-marginals"><i class="fa fa-check"></i><b>3.1.2</b> MCDA from marginals</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="all-analyses.html"><a href="all-analyses.html#approaches-that-we-need-ipd-for"><i class="fa fa-check"></i><b>3.2</b> Approaches that we need IPD for</a><ul>
<li class="chapter" data-level="3.2.1" data-path="all-analyses.html"><a href="all-analyses.html#ordinal-model"><i class="fa fa-check"></i><b>3.2.1</b> Ordinal model</a></li>
<li class="chapter" data-level="3.2.2" data-path="all-analyses.html"><a href="all-analyses.html#mcda-with-conditional"><i class="fa fa-check"></i><b>3.2.2</b> MCDA with conditional</a></li>
</ul></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Data preparation for Harvard Talk</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="generate-pseudo-data" class="section level1">
<h1><span class="header-section-number">2</span> Generate Pseudo Data</h1>
<p>In the final section of this presentation we will walk through a proposal that
pretty much all trial data can and should be turned into portable pseudo data
that is shared freely without restrictions. We has originally planned to show
two versions of this: one using <code>{synthpop}</code> and the other using <code>{mvProbit}</code>.
After reviewing the synthpop documentation more closely however it looks like
you can actually just save the model objects which means you can interact with
them using local data. This is much faster/more general than the multivariate
probit approach so we won’t move that work forward any further. Note that this
repository also includes the code necessary to do a bayesian version of the
multivariate probit model which is primarily of interest if you’d like to do
something like specify treatment effects across binomial outcomes as
shared/exchangeable.</p>
<div id="generate-data-from-synthpop" class="section level2">
<h2><span class="header-section-number">2.1</span> Generate data from synthpop</h2>
<p>We will use vanilla default settings for synthpop since the data here is simulated
but in real applications there is a lot more fine tuning available. We can get
a nice simple default output compare synthetic to original data using the <code>compare</code>
function.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="generate-pseudo-data.html#cb1-1"></a><span class="kw">data</span>(<span class="st">&quot;ex_dat&quot;</span>)</span>
<span id="cb1-2"><a href="generate-pseudo-data.html#cb1-2"></a></span>
<span id="cb1-3"><a href="generate-pseudo-data.html#cb1-3"></a>dat &lt;-<span class="st"> </span><span class="kw">as.data.frame</span>(ex_dat) <span class="op">%&gt;%</span><span class="st"> </span>dplyr<span class="op">::</span><span class="kw">select</span>(trt, mort, sev_ivh, sepsis, cld, nec)</span>
<span id="cb1-4"><a href="generate-pseudo-data.html#cb1-4"></a></span>
<span id="cb1-5"><a href="generate-pseudo-data.html#cb1-5"></a><span class="kw">set.seed</span>(<span class="dv">124</span>)</span>
<span id="cb1-6"><a href="generate-pseudo-data.html#cb1-6"></a>synth_dat &lt;-<span class="st"> </span>xfun<span class="op">::</span><span class="kw">cache_rds</span>({</span>
<span id="cb1-7"><a href="generate-pseudo-data.html#cb1-7"></a>  <span class="kw">syn</span>(dat, <span class="dt">minnumlevels =</span> <span class="dv">5</span>, <span class="dt">m =</span> <span class="dv">10</span>, <span class="dt">models =</span> <span class="ot">FALSE</span>, <span class="dt">method =</span> <span class="st">&quot;parametric&quot;</span>)</span>
<span id="cb1-8"><a href="generate-pseudo-data.html#cb1-8"></a>}, <span class="dt">dir =</span> cache,  <span class="dt">file =</span> <span class="st">&quot;synth_dat.rds&quot;</span>)  </span>
<span id="cb1-9"><a href="generate-pseudo-data.html#cb1-9"></a></span>
<span id="cb1-10"><a href="generate-pseudo-data.html#cb1-10"></a><span class="kw">compare</span>(synth_dat, <span class="dt">data =</span> dat)</span></code></pre></div>
<pre><code>## 
## Comparing percentages observed with synthetic
## 
## $trt
##                  0        1
## observed  50.00000 50.00000
## synthetic 50.13333 49.86667
## 
## $mort
##                  0        1
## observed  84.88889 15.11111
## synthetic 85.05185 14.94815
## 
## $sev_ivh
##                  0        1
## observed  91.55556 8.444444
## synthetic 91.54074 8.459259
## 
## $sepsis
##                  0        1
## observed  78.29630 21.70370
## synthetic 77.97778 22.02222</code></pre>
<p><img src="_main_files/figure-html/unnamed-chunk-1-1.svg" width="672" /></p>
<pre><code>## Press return for next plot: $cld
##                  0        1
## observed  60.29630 39.70370
## synthetic 59.91111 40.08889
## 
## $nec
##                  0        1
## observed  95.70370 4.296296
## synthetic 95.22222 4.777778</code></pre>
<p><img src="_main_files/figure-html/unnamed-chunk-1-2.svg" width="672" /></p>
<p>We can also take a quick look at correlations for a pooled version of
the synthetic datasets vs the observed data.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="generate-pseudo-data.html#cb4-1"></a>synth_dat<span class="op">$</span>syn <span class="op">%&gt;%</span></span>
<span id="cb4-2"><a href="generate-pseudo-data.html#cb4-2"></a><span class="st">  </span><span class="kw">do.call</span>(rbind, .) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb4-3"><a href="generate-pseudo-data.html#cb4-3"></a><span class="st">  </span><span class="kw">mutate_all</span>(as.numeric) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(<span class="op">-</span>trt) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">cor</span>()</span></code></pre></div>
<pre><code>##               mort     sev_ivh     sepsis         cld        nec
## mort     1.0000000  0.10174852 0.11359478 -0.11996149 0.11452450
## sev_ivh  0.1017485  1.00000000 0.08190459 -0.02053963 0.02425813
## sepsis   0.1135948  0.08190459 1.00000000  0.10765597 0.01337243
## cld     -0.1199615 -0.02053963 0.10765597  1.00000000 0.05132358
## nec      0.1145245  0.02425813 0.01337243  0.05132358 1.00000000</code></pre>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="generate-pseudo-data.html#cb6-1"></a>dat[,<span class="op">-</span><span class="dv">1</span>] <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">cor</span>()</span></code></pre></div>
<pre><code>##               mort     sev_ivh     sepsis         cld        nec
## mort     1.0000000  0.11732436 0.11401142 -0.12256408 0.11459764
## sev_ivh  0.1173244  1.00000000 0.10506595 -0.03409620 0.01448092
## sepsis   0.1140114  0.10506595 1.00000000  0.09426759 0.01251141
## cld     -0.1225641 -0.03409620 0.09426759  1.00000000 0.05205256
## nec      0.1145976  0.01448092 0.01251141  0.05205256 1.00000000</code></pre>
<p>For the rest of the presentation we will just use on example dataset. For the
comparison at the end we will create a composite with sev_ivh + cld</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="generate-pseudo-data.html#cb8-1"></a>pres_dat_syn &lt;-<span class="st"> </span>synth_dat<span class="op">$</span>syn[[<span class="dv">10</span>]] <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb8-2"><a href="generate-pseudo-data.html#cb8-2"></a><span class="st">  </span><span class="kw">mutate_all</span>(<span class="op">~</span><span class="st"> </span><span class="kw">as.numeric</span>(<span class="kw">as.character</span>(.))) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb8-3"><a href="generate-pseudo-data.html#cb8-3"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">cld_ivh =</span> <span class="kw">ifelse</span>(sev_ivh <span class="op">==</span><span class="st"> </span><span class="dv">1</span> <span class="op">&amp;</span><span class="st"> </span>cld  <span class="op">==</span><span class="st"> </span><span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb8-4"><a href="generate-pseudo-data.html#cb8-4"></a>         <span class="dt">cld_no_ivh =</span> <span class="kw">ifelse</span>(cld <span class="op">==</span><span class="st"> </span><span class="dv">1</span> <span class="op">&amp;</span><span class="st"> </span>sev_ivh <span class="op">==</span><span class="st"> </span><span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb8-5"><a href="generate-pseudo-data.html#cb8-5"></a>         <span class="dt">ivh_no_cld =</span> <span class="kw">ifelse</span>(cld <span class="op">==</span><span class="st"> </span><span class="dv">0</span> <span class="op">&amp;</span><span class="st"> </span>sev_ivh <span class="op">==</span><span class="st"> </span><span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>))</span>
<span id="cb8-6"><a href="generate-pseudo-data.html#cb8-6"></a></span>
<span id="cb8-7"><a href="generate-pseudo-data.html#cb8-7"></a>pres_dat &lt;-<span class="st"> </span>dat <span class="op">%&gt;%</span></span>
<span id="cb8-8"><a href="generate-pseudo-data.html#cb8-8"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">cld_ivh =</span> <span class="kw">ifelse</span>(sev_ivh <span class="op">==</span><span class="st"> </span><span class="dv">1</span> <span class="op">&amp;</span><span class="st"> </span>cld  <span class="op">==</span><span class="st"> </span><span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb8-9"><a href="generate-pseudo-data.html#cb8-9"></a>         <span class="dt">cld_no_ivh =</span> <span class="kw">ifelse</span>(cld <span class="op">==</span><span class="st"> </span><span class="dv">1</span> <span class="op">&amp;</span><span class="st"> </span>sev_ivh <span class="op">==</span><span class="st"> </span><span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb8-10"><a href="generate-pseudo-data.html#cb8-10"></a>         <span class="dt">ivh_no_cld =</span> <span class="kw">ifelse</span>(cld <span class="op">==</span><span class="st"> </span><span class="dv">0</span> <span class="op">&amp;</span><span class="st"> </span>sev_ivh <span class="op">==</span><span class="st"> </span><span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>))</span>
<span id="cb8-11"><a href="generate-pseudo-data.html#cb8-11"></a></span>
<span id="cb8-12"><a href="generate-pseudo-data.html#cb8-12"></a><span class="kw">colMeans</span>(pres_dat)</span></code></pre></div>
<pre><code>##        trt       mort    sev_ivh     sepsis        cld        nec    cld_ivh cld_no_ivh ivh_no_cld 
## 0.50000000 0.15111111 0.08444444 0.21703704 0.39703704 0.04296296 0.02888889 0.36814815 0.05555556</code></pre>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="generate-pseudo-data.html#cb10-1"></a><span class="kw">colMeans</span>(pres_dat_syn)</span></code></pre></div>
<pre><code>##        trt       mort    sev_ivh     sepsis        cld        nec    cld_ivh cld_no_ivh ivh_no_cld 
## 0.51703704 0.15111111 0.08592593 0.21333333 0.38592593 0.04962963 0.03629630 0.34962963 0.04962963</code></pre>
<p>Overall just taking even a single dataset we’ve done pretty good at replicating
the original data.</p>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="index.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="all-analyses.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
